name: PR
on: pull_request
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Get list of changed files
        id: changedfiles
        uses: tj-actions/changed-files@v42
        with:
          json: "true"
          files: "src/**/*.{ts,tsx}"
      - name: List all changed files
        run: echo '${{ steps.changed-files.outputs.all_changed_files }}'
      - name: Verify that new files in this PR appear in tsconfig.strictNullChecks.json
        uses: actions/github-script@v7
        with:
          script: |
            const tsconfigJson = require('./tsconfig.strictNullChecks.json');
            const newFiles = JSON.parse('${{ steps.changedfiles.outputs.added_files }}')
              .map(file => file.replace('src', '.')); // Adjust to tsconfig format
            if (newFiles.length === 0) {
              console.log('‚úÖ No new files found');
              return;
            }
            console.log('üîÑ Found new files:\n', newFiles.join('\n'))
            const newFilesNotInTsconfig = newFiles.filter(file => !tsconfigJson.files.includes(file));
            if (newFilesNotInTsconfig.length > 0) {
              console.error(`‚ùå These new files should be included in tsconfig.strictNullChecks.json:\n${newFilesNotInTsconfig.join('\n')}`);
              process.exitCode = 1
            } else {
              console.log('‚úÖ The new files are strict');
            }
